<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>广州地铁打卡</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0066cc;
      --primary-dark: #004d99;
      --secondary: #f8f9fa;
      --accent: #ffcc00;
      --success: #28a745;
      --danger: #dc3545;
      --text: #333;
      --text-light: #6c757d;
      --border: #dee2e6;
      --card-bg: rgba(255, 255, 255, 0.9);
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      color: var(--text);
      line-height: 1.6;
      padding: 15px;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="%230066cc" opacity="0.1"/><circle cx="50" cy="30" r="1.5" fill="%230066cc" opacity="0.1"/><circle cx="80" cy="40" r="1" fill="%230066cc" opacity="0.1"/><circle cx="30" cy="70" r="1.5" fill="%230066cc" opacity="0.1"/><circle cx="70" cy="80" r="2" fill="%230066cc" opacity="0.1"/></svg>');
      background-size: 200px;
      opacity: 0.15;
      z-index: -1;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 25px;
      position: relative;
      padding-top: 15px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    
    .logo-icon {
      width: 48px;
      height: 48px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      box-shadow: var(--shadow);
    }
    
    h1 {
      font-size: 2.2rem;
      color: var(--primary);
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 5px;
    }
    
    .subtitle {
      color: var(--text-light);
      font-size: 1rem;
      margin-bottom: 20px;
    }
    
    .search-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      max-width: 600px;
      margin: 0 auto 25px;
    }
    
    .search-box {
      flex: 1;
      position: relative;
    }
    
    .search-box input {
      width: 100%;
      padding: 14px 20px 14px 50px;
      border: 2px solid var(--border);
      border-radius: 50px;
      font-size: 1rem;
      transition: all 0.3s;
      box-shadow: var(--shadow);
    }
    
    .search-box input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.2);
    }
    
    .search-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
      font-size: 1.2rem;
    }
    
    .actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      box-shadow: var(--shadow);
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background: rgba(0, 102, 204, 0.1);
      transform: translateY(-2px);
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    .btn-danger:hover {
      background: #c82333;
      transform: translateY(-2px);
    }
    
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 25px;
      transition: transform 0.3s;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    
    .card-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .lines-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    
    .line-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      min-width: 120px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      border: 2px solid transparent;
    }
    
    .line-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .line-card.active {
      border-color: var(--primary);
      background: rgba(0, 102, 204, 0.05);
    }
    
    .line-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    .line-name {
      font-size: 1rem;
      color: var(--text);
      font-weight: 500;
    }
    
    .progress-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-top: 10px;
    }
    
    .progress-bar {
      flex: 1;
      height: 10px;
      background-color: #e9ecef;
      border-radius: 5px;
      overflow: hidden;
    }
    
    .progress {
      height: 100%;
      background-color: var(--success);
      border-radius: 5px;
      transition: width 0.5s ease;
    }
    
    .progress-text {
      font-size: 0.9rem;
      color: var(--text-light);
      min-width: 80px;
      text-align: right;
    }
    
    .stations-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    
    .station-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
      border: 1px solid var(--border);
    }
    
    .station-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .station-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px dashed var(--border);
    }
    
    .station-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text);
    }
    
    .station-status {
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
    }
    
    .status-checked {
      color: var(--success);
    }
    
    .status-not-checked {
      color: var(--danger);
    }
    
    .station-details {
      margin-bottom: 15px;
      color: var(--text-light);
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .station-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
    }
    
    .upload-btn {
      padding: 10px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .upload-btn:hover {
      background: var(--primary-dark);
    }
    
    .upload-btn.checked {
      background: var(--success);
    }
    
    .upload-btn.checked:hover {
      background: #218838;
    }
    
    .checkin-date {
      font-size: 0.85rem;
      color: var(--text-light);
      font-style: italic;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-light);
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: #ced4da;
    }
    
    .empty-state p {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    
    .modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transform: translateY(-20px);
      transition: transform 0.3s;
    }
    
    .modal.active .modal-content {
      transform: translateY(0);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }
    
    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text);
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
      transition: color 0.3s;
    }
    
    .close-modal:hover {
      color: var(--text);
    }
    
    .modal-body {
      margin-bottom: 25px;
    }
    
    .modal-text {
      font-size: 1.1rem;
      line-height: 1.6;
      margin-bottom: 20px;
      color: var(--text);
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .modal-btn-cancel {
      background: #e9ecef;
      color: var(--text);
    }
    
    .modal-btn-cancel:hover {
      background: #dae0e5;
    }
    
    .modal-btn-confirm {
      background: var(--danger);
      color: white;
    }
    
    .modal-btn-confirm:hover {
      background: #c82333;
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast.error {
      background: var(--danger);
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
      .logo {
        flex-direction: column;
        gap: 8px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .actions {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
        justify-content: center;
      }
      
      .stations-container {
        grid-template-columns: 1fr;
      }
      
      .line-card {
        min-width: 100px;
        padding: 15px;
      }
      
      .line-number {
        font-size: 1.5rem;
      }
    }
    
    @media (max-width: 480px) {
      .card {
        padding: 15px;
      }
      
      .search-container {
        flex-direction: column;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
      
      .modal-actions {
        flex-direction: column;
      }
      
      .modal-btn {
        width: 100%;
      }
    }
    
    /* 动画效果 */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-subway"></i>
        </div>
        <h1>广州地铁打卡</h1>
      </div>
      <p class="subtitle">记录你的地铁旅程，打卡广州每一个站点</p>
      
      <div class="search-container">
        <div class="search-box">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="search-input" placeholder="搜索站点名称...">
        </div>
        <button class="btn btn-outline" id="clear-search">
          <i class="fas fa-times"></i> 清除
        </button>
      </div>
      
      <div class="actions">
        <button class="btn btn-primary" id="show-history">
          <i class="fas fa-history"></i> 查看打卡历史
        </button>
        <button class="btn btn-outline" id="clear-current">
          <i class="fas fa-broom"></i> 清除当前线路打卡
        </button>
        <button class="btn btn-danger" id="clear-all">
          <i class="fas fa-trash-alt"></i> 清除全部打卡数据
        </button>
      </div>
    </header>
    
    <div class="main-content">
      <div class="card fade-in">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-train"></i> 地铁线路</h2>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress" id="overall-progress"></div>
            </div>
            <div class="progress-text" id="overall-progress-text">0/0 (0%)</div>
          </div>
        </div>
        
        <div class="lines-container" id="lines-list"></div>
      </div>
      
      <div class="card fade-in delay-1">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-map-marker-alt"></i> 站点列表</h2>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress" id="line-progress"></div>
            </div>
            <div class="progress-text" id="line-progress-text">0/0 (0%)</div>
          </div>
        </div>
        
        <div class="stations-container" id="stations-list"></div>
      </div>
    </div>
  </div>
  
  <!-- 清除数据确认模态框 -->
  <div class="modal" id="clear-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">确认清除数据</h3>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-text" id="modal-message">您确定要清除所有打卡数据吗？此操作不可撤销。</p>
      </div>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel">取消</button>
        <button class="modal-btn modal-btn-confirm" id="confirm-clear">确认清除</button>
      </div>
    </div>
  </div>
  
  <!-- 提示信息 -->
  <div class="toast" id="toast"></div>
  
  <script>
    // 广州地铁线路数据
    const lines = [
      {
        name: "1号线",
        stations: ["广州东站", "体育中心", "体育西路", "杨箕", "东山口", "烈士陵园", "农讲所", "公园前", "西门口", "陈家祠", "长寿路", "黄沙", "芳村", "花地湾", "坑口", "西塱"]
      },
      {
        name: "2号线",
        stations: ["广州南站", "石壁", "会江", "南浦", "洛溪", "南洲", "东晓南", "江泰路", "昌岗", "江南西", "市二宫", "海珠广场", "公园前", "纪念堂", "越秀公园", "广州火车站", "三元里", "飞翔公园", "白云公园", "白云文化广场", "萧岗", "江夏", "黄边", "嘉禾望岗"]
      },
      {
        name: "3号线",
        stations: ["天河客运站", "五山", "华师", "岗顶", "石牌桥", "体育西路", "珠江新城", "广州塔", "客村", "大塘", "沥滘", "厦滘", "大石", "汉溪长隆", "市桥", "番禺广场", "海傍", "海涌路", "石碁南", "傍江", "林和西", "燕塘", "梅花园", "京溪南方医院", "同和", "永泰", "白云大道北", "嘉禾望岗", "龙归", "人和", "高增", "机场南（1号航站楼）", "机场北（2号航站楼）"]
      },
      {
        name: "4号线",
        stations: ["黄村", "车陂", "车陂南", "万胜围", "官洲", "大学城北", "大学城南", "新造", "石碁", "海傍", "低涌", "东涌", "庆盛", "黄阁汽车城", "黄阁", "蕉门", "金洲", "飞沙角", "广隆", "大涌", "塘坑", "南横", "南沙客运港"]
      },
      {
        name: "5号线",
        stations: ["滘口", "坦尾", "中山八", "西场", "西村", "广州火车站", "小北", "淘金", "区庄", "动物园", "杨箕", "五羊邨", "珠江新城", "猎德", "潭村", "员村", "科韵路", "车陂南", "东圃", "三溪", "鱼珠", "大沙地", "大沙东", "文冲", "双沙", "庙头", "夏园", "保盈大道", "夏港", "黄埔新港"]
      },
      {
        name: "6号线",
        stations: ["浔峰岗", "横沙", "沙贝", "河沙", "坦尾", "如意坊", "黄沙", "文化公园", "一德路", "海珠广场", "北京路", "团一大广场", "东湖", "东山口", "区庄", "黄花岗", "沙河顶", "天平架", "燕塘", "天河客运站", "长湴", "植物园", "龙洞", "柯木塱", "高塘石", "黄陂", "金峰", "暹岗", "苏元", "萝岗", "香雪"]
      },
      {
        name: "7号线",
        stations: ["美的大道", "北滘公园", "美的", "南涌", "锦龙", "陈村", "陈村北", "大洲", "广州南站", "石壁", "谢村", "钟村", "汉溪长隆", "南村万博", "员岗", "板桥", "大学城南", "深井", "长洲", "裕丰围", "大沙东", "姬堂", "加庄", "科丰路", "萝岗", "水西", "燕山"]
      },
      {
        name: "8号线",
        stations: ["万胜围", "琶洲", "新港东", "磨碟沙", "赤岗", "客村", "鹭江", "中大", "晓港", "昌岗", "宝岗大道", "沙园", "凤凰新村", "同福西", "文化公园", "华林寺", "陈家祠", "彩虹桥", "西村", "鹅掌坦", "同德", "上步", "聚龙", "石潭", "小坪", "石井", "亭岗", "滘心"]
      },
      {
        name: "9号线",
        stations: ["飞鹅岭", "花都汽车城", "广州北站", "花城路", "花果山公园", "花都广场", "马鞍山公园", "莲塘", "清布", "清塘", "高增"]
      },
      {
        name: "10号线",
        stations: ["西塱", "花围", "东沙", "大干围", "工业大道南", "东晓南", "五凤", "中大南门", "滨江东路", "东湖", "五羊邨", "杨箕东", "天河路", "石牌桥", "岗顶", "华师", "五山", "天河客运站"]
      },
      {
        name: "11号线",
        stations: ["赤沙", "琶洲", "员村", "天河公园", "华景路", "华师", "龙口西", "广州东站", "沙河", "云台花园", "大金钟路", "中医药大学", "梓元岗", "广州火车站", "流花", "彩虹桥", "中山八", "如意坊", "石围塘", "芳村", "大冲口", "沙涌", "鹤洞东", "棣园", "燕岗", "江泰路", "五凤", "逸景路", "上涌", "大塘", "龙潭"]
      },
      {
        name: "12号线",
        stations: ["浔峰岗", "浔峰岗北", "西洲", "聚龙", "广州白云站", "棠涌", "新市墟", "白云文化广场", "广州体育馆", "景泰", "柯子岭", "中医药大学", "麓湖", "建设六马路", "烈士陵园", "东湖", "二沙岛", "赤岗塔", "赤岗", "赤沙北", "赤沙", "北山", "官洲", "大学城北", "大学城南"]
      },
      {
        name: "13号线",
        stations: ["鱼珠", "裕丰围", "双岗", "南海神庙", "夏园", "南岗", "沙村", "白江", "新塘", "官湖", "新沙", "天河公园", "棠下", "车陂", "天河珠村", "朝阳", "庆丰", "凰岗", "西洲", "松溪", "罗冲围", "西场", "彩虹桥", "纪念堂", "建设六马路"]
      },
      {
        name: "14号线",
        stations: ["嘉禾望岗", "白云东平", "夏良", "太和", "竹料", "钟落潭", "马沥", "新和", "太平", "神岗", "赤草", "从化客运站", "东风", "红卫", "新南", "枫下", "知识城", "何棠下", "旺村", "汤村", "镇龙北", "镇龙"]
      },
      {
        name: "18号线",
        stations: ["万顷沙", "横沥", "番禺广场", "南村万博", "沙溪", "龙潭", "磨碟沙", "冼村"]
      },
      {
        name: "21号线",
        stations: ["天河公园", "棠东", "黄村", "大观南路", "天河智慧城", "神舟路", "科学城", "苏元", "水西", "长平", "金坑", "镇龙西", "镇龙", "中新", "坑贝", "凤岗", "朱村", "山田", "钟岗", "增城广场"]
      },
      {
        name: "22号线",
        stations: ["番禺广场", "市广路", "广州南站", "陈头岗", "南浦西", "南漖", "西塱", "芳村", "彩虹桥", "广州火车站", "广州白云站", "夏茅", "白云城市中心", "方石", "人和", "机场东（3号航站楼）"]
      },
      {
        name: "广佛线",
        stations: ["新城东", "东平", "世纪莲", "澜石", "魁奇路", "季华园", "同济路", "祖庙", "普君北路", "朝安", "桂城", "南桂路", "虫雷岗", "千灯湖", "金融高新区", "龙溪", "菊树", "西塱", "鹤洞", "沙涌", "沙园", "燕岗", "石溪", "南洲", "沥滘"]
      },
      {
        name: "APM线",
        stations: ["广州塔", "海心沙", "大剧院", "花城大道", "妇儿中心", "黄埔大道", "天河南", "体育中心南", "林和西"]
      }
    ];

    let currentLine = null; // 当前显示的线路
    let allStations = []; // 所有站点数据
    let totalStations = 0; // 总站点数
    let checkedStations = 0; // 已打卡站点数

    // DOM元素
    const linesListEl = document.getElementById('lines-list');
    const stationsListEl = document.getElementById('stations-list');
    const searchInputEl = document.getElementById('search-input');
    const clearSearchBtn = document.getElementById('clear-search');
    const clearCurrentBtn = document.getElementById('clear-current');
    const clearAllBtn = document.getElementById('clear-all');
    const showHistoryBtn = document.getElementById('show-history');
    const modalEl = document.getElementById('clear-modal');
    const closeModalBtn = document.querySelector('.close-modal');
    const confirmClearBtn = document.getElementById('confirm-clear');
    const modalMessageEl = document.getElementById('modal-message');
    const toastEl = document.getElementById('toast');
    const overallProgressEl = document.getElementById('overall-progress');
    const overallProgressTextEl = document.getElementById('overall-progress-text');
    const lineProgressEl = document.getElementById('line-progress');
    const lineProgressTextEl = document.getElementById('line-progress-text');

    // 初始化：计算所有站点数据
    function initStationData() {
      totalStations = 0;
      checkedStations = 0;
      allStations = [];
      
      lines.forEach(line => {
        totalStations += line.stations.length;
        line.stations.forEach(station => {
          const key = `${line.name}-${station}`;
          const isChecked = localStorage.getItem(key) === 'true';
          if (isChecked) checkedStations++;
          
          allStations.push({
            line: line.name,
            name: station,
            key: key,
            checked: isChecked,
            date: localStorage.getItem(`${key}-date`) || null
          });
        });
      });
      
      updateOverallProgress();
    }

    // 更新整体进度
    function updateOverallProgress() {
      const percentage = totalStations > 0 ? Math.round((checkedStations / totalStations) * 100) : 0;
      overallProgressEl.style.width = `${percentage}%`;
      overallProgressTextEl.textContent = `${checkedStations}/${totalStations} (${percentage}%)`;
    }

    // 更新线路进度
    function updateLineProgress(checked, total) {
      const percentage = total > 0 ? Math.round((checked / total) * 100) : 0;
      lineProgressEl.style.width = `${percentage}%`;
      lineProgressTextEl.textContent = `${checked}/${total} (${percentage}%)`;
    }

    // 渲染线路列表
    function renderLines() {
      linesListEl.innerHTML = '';
      
      lines.forEach((line, index) => {
        const lineCard = document.createElement('div');
        lineCard.className = 'line-card fade-in';
        lineCard.classList.add(`delay-${(index % 3) + 1}`);
        if (currentLine && currentLine.name === line.name) {
          lineCard.classList.add('active');
        }
        
        // 计算该线路的打卡进度
        let lineChecked = 0;
        line.stations.forEach(station => {
          const key = `${line.name}-${station}`;
          if (localStorage.getItem(key) === 'true') lineChecked++;
        });
        
        const percentage = line.stations.length > 0 ? 
          Math.round((lineChecked / line.stations.length) * 100) : 0;
        
        lineCard.innerHTML = `
          <div class="line-number">${line.name}</div>
          <div class="line-name">${line.name}</div>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress" style="width: ${percentage}%"></div>
            </div>
            <div class="progress-text">${lineChecked}/${line.stations.length}</div>
          </div>
        `;
        
        lineCard.onclick = () => renderStations(line);
        linesListEl.appendChild(lineCard);
      });
    }

    // 渲染站点列表
    function renderStations(line, searchTerm = '') {
      currentLine = line;
      
      // 更新线路按钮激活状态
      document.querySelectorAll('.line-card').forEach(card => {
        card.classList.remove('active');
      });
      document.querySelectorAll('.line-card').forEach(card => {
        if (card.querySelector('.line-number').textContent === line.name) {
          card.classList.add('active');
        }
      });
      
      const stationsList = line.stations;
      stationsListEl.innerHTML = '';
      
      if (stationsList.length === 0) {
        stationsListEl.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-train"></i>
            <p>该线路暂无站点数据</p>
          </div>
        `;
        updateLineProgress(0, 0);
        return;
      }
      
      let checkedCount = 0;
      let hasResults = false;
      
      stationsList.forEach((station, index) => {
        const key = `${line.name}-${station}`;
        const isChecked = localStorage.getItem(key) === 'true';
        const checkinDate = localStorage.getItem(`${key}-date`);
        
        if (isChecked) checkedCount++;
        
        // 搜索过滤
        if (searchTerm && !station.includes(searchTerm)) {
          return;
        }
        
        hasResults = true;
        
        const stationCard = document.createElement('div');
        stationCard.className = 'station-card fade-in';
        stationCard.classList.add(`delay-${(index % 3) + 1}`);
        
        stationCard.innerHTML = `
          <div class="station-header">
            <div class="station-name">${station}</div>
            <div class="station-status ${isChecked ? 'status-checked' : 'status-not-checked'}">
              <i class="fas ${isChecked ? 'fa-check-circle' : 'fa-times-circle'}"></i>
              ${isChecked ? '已打卡' : '未打卡'}
            </div>
          </div>
          <div class="station-details">
            所属线路：${line.name}<br>
            站点编号：${index + 1}
          </div>
          <div class="station-actions">
            <button class="upload-btn ${isChecked ? 'checked' : ''}" data-key="${key}">
              <i class="fas ${isChecked ? 'fa-check' : 'fa-upload'}"></i>
              ${isChecked ? '已打卡' : '上传图片'}
            </button>
            ${checkinDate ? `<div class="checkin-date">${checkinDate}</div>` : ''}
          </div>
        `;
        
        stationsListEl.appendChild(stationCard);
      });
      
      if (!hasResults && searchTerm) {
        stationsListEl.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-search"></i>
            <p>没有找到匹配的站点</p>
            <p>请尝试其他搜索关键词</p>
          </div>
        `;
      }
      
      updateLineProgress(checkedCount, stationsList.length);
    }

    // 处理上传图片
    function handleUpload(key) {
      // 模拟上传过程
      showToast('打卡成功！站点已标记为已打卡', 'success');
      
      // 更新状态
      localStorage.setItem(key, 'true');
      
      // 记录打卡日期
      const now = new Date();
      const dateStr = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
      localStorage.setItem(`${key}-date`, dateStr);
      
      // 重新渲染当前线路
      if (currentLine) {
        renderStations(currentLine, searchInputEl.value.trim());
      }
      
      // 更新整体进度
      initStationData();
    }

    // 清除当前线路打卡数据
    function clearCurrentLineData() {
      if (!currentLine) {
        showToast('请先选择一条线路', 'error');
        return;
      }
      
      modalMessageEl.textContent = `您确定要清除${currentLine.name}的所有打卡数据吗？此操作不可撤销。`;
      modalEl.classList.add('active');
      
      confirmClearBtn.onclick = () => {
        currentLine.stations.forEach(station => {
          const key = `${currentLine.name}-${station}`;
          localStorage.removeItem(key);
          localStorage.removeItem(`${key}-date`);
        });
        
        modalEl.classList.remove('active');
        showToast(`${currentLine.name}打卡数据已清除`, 'success');
        
        // 重新渲染
        renderStations(currentLine, searchInputEl.value.trim());
        initStationData();
      };
    }

    // 清除所有打卡数据
    function clearAllData() {
      modalMessageEl.textContent = '您确定要清除所有线路的打卡数据吗？此操作不可撤销。';
      modalEl.classList.add('active');
      
      confirmClearBtn.onclick = () => {
        lines.forEach(line => {
          line.stations.forEach(station => {
            const key = `${line.name}-${station}`;
            localStorage.removeItem(key);
            localStorage.removeItem(`${key}-date`);
          });
        });
        
        modalEl.classList.remove('active');
        showToast('所有打卡数据已清除', 'success');
        
        // 重新渲染
        if (currentLine) {
          renderStations(currentLine, searchInputEl.value.trim());
        }
        initStationData();
      };
    }

    // 显示打卡历史
    function showCheckinHistory() {
      const checkedStations = allStations.filter(station => station.checked);
      
      if (checkedStations.length === 0) {
        showToast('您还没有打卡记录', 'error');
        return;
      }
      
      // 按日期排序
      checkedStations.sort((a, b) => {
        if (!a.date) return 1;
        if (!b.date) return -1;
        return new Date(b.date) - new Date(a.date);
      });
      
      // 显示历史记录
      stationsListEl.innerHTML = '';
      
      checkedStations.forEach((station, index) => {
        const stationCard = document.createElement('div');
        stationCard.className = 'station-card fade-in';
        stationCard.classList.add(`delay-${(index % 3) + 1}`);
        
        stationCard.innerHTML = `
          <div class="station-header">
            <div class="station-name">${station.name}</div>
            <div class="station-status status-checked">
              <i class="fas fa-check-circle"></i>
              已打卡
            </div>
          </div>
          <div class="station-details">
            所属线路：${station.line}号线<br>
            打卡日期：${station.date}
          </div>
          <div class="station-actions">
            <button class="upload-btn checked" data-key="${station.key}">
              <i class="fas fa-check"></i>
              已打卡
            </button>
          </div>
        `;
        
        stationsListEl.appendChild(stationCard);
      });
      
      // 更新标题
      document.querySelector('.card-title').innerHTML = `<i class="fas fa-history"></i> 打卡历史 (${checkedStations.length}个站点)`;
      updateLineProgress(checkedStations.length, checkedStations.length);
    }

    // 显示提示信息
    function showToast(message, type = 'success') {
      toastEl.textContent = message;
      toastEl.className = 'toast';
      toastEl.classList.add(type);
      toastEl.classList.add('show');
      
      setTimeout(() => {
        toastEl.classList.remove('show');
      }, 3000);
    }

    // 事件监听
    document.addEventListener('click', (e) => {
      // 上传按钮
      if (e.target.closest('.upload-btn')) {
        const btn = e.target.closest('.upload-btn');
        if (!btn.classList.contains('checked')) {
          const key = btn.getAttribute('data-key');
          handleUpload(key);
        }
      }
    });

    // 搜索功能
    searchInputEl.addEventListener('input', () => {
      const searchTerm = searchInputEl.value.trim();
      if (currentLine) {
        renderStations(currentLine, searchTerm);
      }
    });

    // 清除搜索
    clearSearchBtn.addEventListener('click', () => {
      searchInputEl.value = '';
      if (currentLine) {
        renderStations(currentLine);
      }
    });

    // 清除当前线路数据
    clearCurrentBtn.addEventListener('click', clearCurrentLineData);

    // 清除所有数据
    clearAllBtn.addEventListener('click', clearAllData);

    // 显示历史记录
    showHistoryBtn.addEventListener('click', showCheckinHistory);

    // 关闭模态框
    closeModalBtn.addEventListener('click', () => {
      modalEl.classList.remove('active');
    });

    document.querySelector('.modal-btn-cancel').addEventListener('click', () => {
      modalEl.classList.remove('active');
    });

    // 页面加载时初始化
    window.onload = function() {
      initStationData();
      renderLines();
      
      // 初始显示第一条线路
      if (lines.length > 0) {
        renderStations(lines[0]);
      }
    };
  </script>
</body>
</html>
